let currentUser = null;

const defaultUsers = [
{username:"developer_master", password:"Dev@123Secure", role:"developer"},
{username:"admin_manager", password:"Admin@456Secure", role:"admin"}
];

if(!localStorage.getItem("users")){
localStorage.setItem("users", JSON.stringify(defaultUsers));
localStorage.setItem("members", JSON.stringify([]));
}

function login(){
let u = document.getElementById("username").value;
let p = document.getElementById("password").value;

let users = JSON.parse(localStorage.getItem("users"));
let user = users.find(x=>x.username===u);

if(!user){
alert("User not found");
return;
}

if(user.password === null){
showPasswordSetup(user);
return;
}

if(user.password === p){
currentUser=user;
document.getElementById("loginPage").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");
document.getElementById("roleTitle").innerText="Welcome "+user.role.toUpperCase();
showDashboard();
}else{
alert("Wrong Password");
}
}

function showPasswordSetup(user){
document.getElementById("loginPage").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");

document.getElementById("main").innerHTML=`
<h2>Set Your Password</h2>
<input type="password" id="newPass" placeholder="New Password">
<button onclick="savePassword('${user.username}')">Save Password</button>
`;
}

function savePassword(username){
let users = JSON.parse(localStorage.getItem("users"));
let user = users.find(x=>x.username===username);
user.password = document.getElementById("newPass").value;

localStorage.setItem("users", JSON.stringify(users));

alert("Password Set Successfully. Please Login Again.");
location.reload();
}

function logout(){
location.reload();
}
